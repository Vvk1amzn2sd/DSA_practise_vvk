<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DSA Challenge</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Top Bar -->
  <div id="topBar">
    <h2>ðŸ”¥ DSA Challenge</h2>
    <button onclick="toggleDarkMode()">ðŸŒ“ Toggle Dark Mode</button>
  </div>

  <!-- Layout: Leaderboard Left, Content Right -->
  <div id="layoutContainer">
    
    <!-- Left: Leaderboard -->
    <div id="leaderboardPanel">
      <button onclick="toggleLeaderboardDate()">Toggle Day</button>
      <h4 id="leaderboardTitle">Today's Toppers</h4>
      <ul id="leaderboardList"></ul>
    </div>

    <!-- Right: Question & IDE -->
    <div id="mainContent">
      <h2>Challenge</h2>
      <pre id="questionText">Loading...</pre>
      <!-- Add your IDE below -->
    </div>

  </div>

  <!-- Firebase + App Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      // ðŸ”’ Your Firebase config here
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let isToday = true;

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
      document.getElementById("leaderboardPanel").classList.toggle("dark-panel");
      document.getElementById("mainContent").classList.toggle("dark-panel");
      document.getElementById("topBar").classList.toggle("dark-topbar");
    }

    function toggleLeaderboardDate() {
      isToday = !isToday;
      document.getElementById("leaderboardTitle").innerText =
        isToday ? "Today's Toppers" : "Yesterday's Toppers";
      loadLeaderboard();
    }

    function formatDate(offset = 0) {
      const d = new Date();
      d.setDate(d.getDate() + offset);
      const day = String(d.getDate()).padStart(2, '0');
      const month = d.toLocaleString("default", { month: "long" }).toLowerCase();
      return `day_${day}_${month}`;
    }

    function loadLeaderboard() {
      const dateKey = formatDate(isToday ? 0 : -1);
      const category = "easy"; // Update if needed

      const leaderboardRef = ref(db, `leaderboard/${dateKey}/${category}`);
      onValue(leaderboardRef, (snapshot) => {
        const data = snapshot.val();
        const list = document.getElementById("leaderboardList");
        list.innerHTML = "";

        if (data) {
          const entries = Object.values(data);
          entries.sort((a, b) => a.time - b.time);
          entries.forEach(entry => {
            const li = document.createElement("li");
            li.textContent = `${entry.name} - ${entry.time}s`;
            list.appendChild(li);
          });
        } else {
          const li = document.createElement("li");
          li.textContent = "No entries.";
          list.appendChild(li);
        }
      });
    }

    function loadQuestion() {
      const dateKey = formatDate(0);
      const fileUrl = `https://your-path/questions/${dateKey}_1.txt`; // update path if needed

      fetch(fileUrl)
        .then(res => res.ok ? res.text() : Promise.resolve("No challenge found."))
        .then(text => {
          document.getElementById("questionText").textContent = text;
        })
        .catch(() => {
          document.getElementById("questionText").textContent = "Error loading question.";
        });
    }

    loadLeaderboard();
    loadQuestion();
  </script>

</body>
</html>
